<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Formant Analyzer Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/style.css" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    /* Minimal nav styles that piggyback on your theme */
    .nav { display:flex; align-items:center; gap:8px; margin-left:auto; }
    .nav a { text-decoration:none; }
    .btn.navlink {
      background:#111827; border:1px solid #374151; color:#e6edf3;
      padding:8px 12px; border-radius:10px; font-weight:600;
    }
    .btn.navlink.active { border-color:#6ae3ff; box-shadow:0 0 0 2px rgba(106,227,255,.15) inset; }
    .brand { display:flex; align-items:center; gap:8px; }
    .brand .tag { margin-left:4px; font-size:.85em; opacity:.8; }
    @media (max-width: 720px) {
      .readout { display:none; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">Formant Analyzer <span class="tag">enhanced</span></div>
    <div class="readout">
      <span>Time: <strong id="ro-time">–</strong> s</span>
      <span>Freq: <strong id="ro-freq">–</strong> Hz</span>
      <span>Level: <strong id="ro-level">–</strong> dB</span>
    </div>

    <!-- Shared menu -->
    <nav class="nav" aria-label="Primary">
      <a class="btn navlink" href="/">Analyzer</a>
      <a class="btn navlink" href="/compare">Spectrogram Comparator</a>
      <!-- Add more entries if you like:
      <a class="btn navlink" href="/about">About</a>
      -->
    </nav>
  </header>

  <main class="layout" id="mainLayout" aria-busy="false" aria-live="polite">
    <aside class="controls">
      <div class="card">
        <h3>1) Upload</h3>
        <form id="uploadForm">
          <input type="file" id="fileInput" accept="audio/*" required>
          <div class="row">
            <label>Method</label>
            <select id="method">
              <option value="raw">Raw Audio (Parselmouth)</option>
              <option value="image">Image-Based (Contours)</option>
            </select>
          </div>
            <div class="row">
              <label><input type="checkbox" id="denoiseChk"> Remove background noise (beta)</label>
              <!-- NEW: ML cleaner checkbox -->
              <label style="margin-left:10px;">
                <input type="checkbox" id="mlCleanChk"> ML Clean (hybrid)
              </label>
            </div>


          <div id="rawParams" class="params">
            <label>Max formants</label>
            <input type="number" id="maxFormants" value="20" min="1" max="40">
            <label>Duration limit (s)</label>
            <input type="number" id="durLimit" value="5.0" step="0.1" min="0.5" max="30">
          </div>

          <div id="imgParams" class="params" style="display:none">
            <label>Percentile</label>
            <input type="number" id="percentile" value="90" min="50" max="99">
            <label>Max freq range (Hz)</label>
            <input type="number" id="maxFreqRange" value="500" min="50" max="4000">
            <label>Min contour length (pts)</label>
            <input type="number" id="minLen" value="20" min="5" max="1000">
          </div>

          <button type="submit" id="analyzeBtn" class="btn primary">Analyze</button>
          <button id="reAnalyze" type="button" class="btn" disabled>Re-Analyze (same audio)</button>
        </form>
      </div>

      <div class="card">
        <h3>2) View Options</h3>
        <div class="row">
          <label>Colormap</label>
          <select id="cmap">
            <option value="NeonGreen">NeonGreen</option>
            <option value="Inferno">Inferno</option>
            <option value="Magma">Magma</option>
            <option value="Viridis">Viridis</option>
            <option value="Cividis">Cividis</option>
            <option value="Plasma">Plasma</option>
            <option value="Jet">Jet</option>
            <option value="Greys">Greys</option>
          </select>
        </div>

        <div id="rawToggles" class="row" style="display:none">
          <label><input type="checkbox" id="toggleF0" checked> Show F0</label>
          <label><input type="checkbox" id="toggleFormants" checked> Show Formants</label>
        </div>

        <div id="imgToggles" class="row" style="display:none">
          <label><input type="checkbox" id="toggleContours" checked> Show Contours</label>
        </div>

        <div class="row">
          <button id="downloadPng" class="btn">Download PNG</button>
        </div>
      </div>

      <div class="card">
        <h3>3) Export Tables</h3>
        <div class="row">
          <button id="dlDist" class="btn">Distance Matrix CSV</button>
          <button id="dlTime" class="btn">Time Ranges CSV</button>
        </div>
      </div>

      <div class="card">
        <h3>Audio</h3>
        <audio id="player" controls preload="auto"></audio>
        <div class="row">
          <label>Click spectrogram to seek • Playhead line is synced</label>
        </div>
      </div>
    </aside>

    <section class="workspace">
      <div class="tabs">
        <button class="tab active" data-tab="spec">Spectrogram</button>
        <button class="tab" data-tab="bark">Bark Bands</button>
        <button class="tab" data-tab="tables">Tables</button>
      </div>

      <div id="tab-spec" class="tabpane active">
        <div id="specPlot" class="plot"></div>
      </div>

      <div id="tab-bark" class="tabpane">
        <div id="barkPlot" class="plot small"></div>
      </div>

      <div id="tab-tables" class="tabpane">
        <div class="tables">
          <div class="tablecard">
            <h4>Distance Matrix</h4>
            <div class="tablewrap">
              <div id="distTable"></div>
            </div>
          </div>
          <div class="tablecard">
            <h4>Formant Time Ranges</h4>
            <div class="tablewrap">
              <div id="timeTable"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Loader Overlay -->
  <div id="loaderOverlay" class="loader hidden" role="status" aria-live="assertive" aria-label="Analyzing…">
    <div class="spinner" aria-hidden="true"></div>
    <div class="loader-text">Analyzing…</div>
  </div>

  <footer class="foot">
    <small>Inspired by SpectraLayers 10 features—hover readouts, zoom/pan, overlays.</small>
  </footer>

  <script>
    // Highlight active menu item
    (function() {
      const path = location.pathname || "/";
      document.querySelectorAll('.nav .navlink').forEach(a => {
        if ((a.getAttribute('href') === "/" && path === "/") ||
            (a.getAttribute('href') !== "/" && path.startsWith(a.getAttribute('href')))) {
          a.classList.add('active');
        }
      });
    })();
  </script>
  <script src="/static/app.js"></script>
</body>
</html>
